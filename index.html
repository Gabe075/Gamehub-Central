<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GameHub Central</title>
<meta name="description" content="GameHub Central ‚Äî mods, apps e GameHub Games integrado (one-file)"/>
<style>
:root{
  --bg:#0b0712;
  --panel:#0f0c18;
  --accent1:#7c3aed;
  --accent2:#b889ff;
  --muted:#cfcbe2;
  --text:#f1ecff;
  --card-radius:14px;
  --btn-h:48px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Roboto,Arial;background:
  radial-gradient(800px 300px at 8% 6%, rgba(139,75,255,0.06), transparent 8%), var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
.container{max-width:1000px;margin:12px auto;padding:10px}

/* header */
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:56px;height:56px;border-radius:12px;overflow:hidden;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:grid;place-items:center}
.logo img{width:100%;height:100%;object-fit:cover}
.title{font-weight:800;font-size:18px}
.subtitle{color:var(--muted);font-size:13px}
.controls{display:flex;gap:10px;align-items:center}

/* layout */
.layout{display:grid;grid-template-columns:1fr 320px;gap:18px}
@media(max-width:900px){ .layout{grid-template-columns:1fr} }

/* cards */
.cards{display:flex;flex-direction:column;gap:14px}
.card{display:flex;gap:14px;align-items:flex-start;padding:16px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.006));border:1px solid rgba(255,255,255,0.03)}
.thumb{width:96px;height:84px;border-radius:12px;overflow:hidden;background:#040406;flex-shrink:0}
.thumb img{width:100%;height:100%;object-fit:cover}
.info{flex:1}
.title-card{font-weight:900;font-size:16px}
.desc{color:var(--muted);font-size:14px}
.meta{color:var(--muted);font-size:13px;margin-top:10px}
.chev{width:40px;height:40px;border-radius:10px;background:rgba(255,255,255,0.02);display:grid;place-items:center;color:var(--muted)}

/* sidebar */
#sidebar-backdrop{position:fixed;inset:0;background:transparent;display:none;z-index:190}
.sidebar{position:fixed;left:calc(-1 * 320px);top:0;height:100%;width:320px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-right:1px solid rgba(255,255,255,0.03);padding:18px;transition:left .28s cubic-bezier(.2,.9,.2,1);z-index:200;backdrop-filter: blur(6px);}
.sidebar.open{left:0}
.sb-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:12px}
.search-block{background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.008));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.search-block input{width:100%;padding:10px;border-radius:10px;border:0;background:transparent;color:var(--text);outline:0}
.social-grid{display:flex;flex-direction:column;gap:12px;margin-top:12px}
.social-btn{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;color:#fff;font-weight:800;background:linear-gradient(90deg,var(--accent1),var(--accent2));box-shadow:0 10px 30px rgba(124,58,237,0.12);text-decoration:none}
.social-btn.wh{background:#25D366}
.social-btn.yt{background:linear-gradient(90deg,#FF4A4A,#FF8A00)}
.share-site{display:inline-flex;align-items:center;justify-content:center;gap:10px;padding:12px;border-radius:12px;width:100%;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);font-weight:800;height:var(--btn-h);text-decoration:none}

/* details */
.detail-page{position:fixed;inset:0;background:linear-gradient(180deg, rgba(3,2,6,0.96), rgba(8,6,12,0.98));z-index:250;display:none;overflow:auto;padding:16px}
.detail-inner{max-width:980px;margin:8px auto;padding:14px}
.detail-hero{height:300px;border-radius:10px;overflow:hidden;background:#040406}
.detail-title{font-weight:900;font-size:20px;margin-top:12px}
.detail-body{color:var(--muted);margin-top:8px;line-height:1.6}
.screens{display:flex;gap:8px;overflow:auto;margin-top:12px}
.screens img{width:220px;height:120px;object-fit:cover;border-radius:8px}

/* GAMES */
.games-root{display:none;padding:12px}
.games-wrap{max-width:600px;margin:0 auto}
.tabs{display:flex;gap:8px;margin:12px 0;overflow:auto;padding-bottom:6px}
.tab{padding:8px 12px;border-radius:999px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted);font-weight:700;cursor:pointer;white-space:nowrap}
.tab.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;box-shadow:0 8px 28px rgba(124,58,237,0.12)}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;padding:14px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 40px rgba(0,0,0,0.6)}
.game-area{display:grid;gap:12px;align-items:start}
.board{width:100%;border-radius:12px;background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.12));overflow:hidden;border:1px solid rgba(255,255,255,0.03);padding:12px}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.btn{padding:12px 18px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;font-weight:800;cursor:pointer;height:var(--btn-h)}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

/* tic tac toe */
#t3-board{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;padding:12px;max-width:360px}
#t3-board button{aspect-ratio:1/1;border-radius:12px;border:0;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));font-size:44px;font-weight:900;color:#fff;cursor:pointer;transition:transform .12s ease, background .18s}
#t3-board button:active{transform:scale(.98)}
#t3-board button.win{background:linear-gradient(90deg,#19d3ff,#7c3aed);color:#041226}

/* memory */
.mem-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:8px;max-width:360px}
.mem-card{aspect-ratio:1/1;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));display:grid;place-items:center;font-size:26px;font-weight:900;cursor:pointer;user-select:none;transform-style:preserve-3d;transition:transform .45s cubic-bezier(.2,.9,.2,1)}
.mem-card .front,.mem-card .back{position:absolute;inset:0;display:grid;place-items:center;border-radius:12px}
.mem-card .front{transform:rotateY(180deg);backface-visibility:hidden;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff}
.mem-card .back{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));backface-visibility:hidden}
.mem-card.revealed{transform:rotateY(180deg)}

/* puzzle */
.puz-grid{display:grid;gap:10px;padding:10px;max-width:360px;grid-template-columns:repeat(4,1fr)}
.puz-cell{display:grid;place-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;font-weight:800;color:#fff;cursor:pointer;user-select:none;transition:transform .18s cubic-bezier(.2,.9,.2,1);height:calc((100vw - 120px)/4)}
.puz-cell:active{transform:scale(.98)}

/* snake & flappy canvas sizing - larger */
.canvas{width:100%;height:auto;border-radius:12px;background:#040406;display:block;max-height:420px}

/* toast */
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;background:rgba(0,0,0,0.9);color:#fff;padding:10px 16px;border-radius:10px;font-weight:700;z-index:400;opacity:0;transition:opacity .18s;pointer-events:none}
.toast.show{opacity:1}

/* small */
.kv{color:var(--muted);font-size:13px}
.footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
@media(max-width:420px){ .sidebar{width:100%;left:-100%} .detail-hero{height:220px} .screens img{width:160px;height:100px} #t3-board{max-width:320px} .mem-grid{max-width:320px} .puz-grid{max-width:320px} }
</style>
</head>
<body>

<div class="container">

  <header class="header">
    <div class="brand">
      <div class="logo"><img id="logoImg" src="logo.png" alt="logo" onerror="this.src='https://raw.githubusercontent.com/Gabe075/Imagem/refs/heads/main/IMG-20251116-WA0008.jpg'"></div>
      <div>
        <div class="title">GameHub Central</div>
        <div class="subtitle">Mods, apps e utilit√°rios ‚Ä¢ Mobile</div>
      </div>
    </div>
    <div class="controls">
      <button id="openSidebar" class="btn ghost">Menu</button>
    </div>
  </header>

  <main class="layout">

    <section id="homeView">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
        <div style="font-weight:900">Bem-vindo</div>
        <div class="kv">Toque num app para ver detalhes</div>
      </div>
      <div id="cards" class="cards"></div>
    </section>

    <aside class="sidebar" id="sidebar" aria-hidden="true">
      <div class="sb-head">
        <div style="display:flex;align-items:center;gap:10px">
          <div class="logo"><img src="logo.png" alt="logo" onerror="this.src='https://raw.githubusercontent.com/Gabe075/Imagem/refs/heads/main/IMG-20251116-WA0008.jpg'"></div>
          <div>
            <div style="font-weight:900">GameHub Central</div>
            <div class="kv">Links e pesquisa</div>
          </div>
        </div>
        <button id="closeSidebar" class="btn ghost">‚úï</button>
      </div>

      <div class="search-block">
        <label class="kv" style="display:block;margin-bottom:8px">Pesquisar</label>
        <input id="sideSearch" placeholder="Pesquisar por nome, descri√ß√£o ou tag">
      </div>

      <div style="height:10px"></div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div style="font-weight:900">Redes sociais</div>
        <div class="kv">Abrir</div>
      </div>

      <div class="social-grid">
        <a class="social-btn" id="instaBtn" href="https://www.instagram.com/gabe.am29?igsh=bDc4dHl3ZGNhcm4y" target="_blank" rel="noopener">Instagram</a>
        <a class="social-btn wh" id="whatsBtn" href="https://chat.whatsapp.com/Kma7lW0piMU8njwKvqo5e1?mode=hqrc" target="_blank" rel="noopener">Grupo WhatsApp</a>
        <a class="social-btn yt" id="ytBtn" href="https://www.youtube.com/@GabeAM29" target="_blank" rel="noopener">YouTube</a>
      </div>

      <div style="height:14px"></div>

      <a href="#/games" id="gamesLink" class="share-site" style="display:block;text-align:center">GameHub Games</a>

      <div style="height:12px"></div>

      <a id="shareSiteBtn" class="share-site" href="#" onclick="navigator.clipboard?.writeText(location.href).then(()=>{toast('Link copiado')}).catch(()=>toast('N√£o foi poss√≠vel copiar'));return false;">Compartilhar site</a>

      <div style="position:absolute;bottom:18px;left:18px;right:18px;color:var(--muted);font-size:13px">GameHub Central ‚Ä¢ Mobile</div>
    </aside>

  </main>
</div>

<!-- Detail overlay -->
<div id="detailPage" class="detail-page" aria-hidden="true">
  <div class="detail-inner" id="detailInner"></div>
</div>

<!-- Games page -->
<div id="gamesPage" class="games-root" aria-hidden="true">
  <div class="games-wrap">
    <header style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
      <div class="logo" style="width:48px;height:48px"><img src="logo.png" alt="logo" onerror="this.src='https://raw.githubusercontent.com/Gabe075/Imagem/refs/heads/main/IMG-20251116-WA0008.jpg'"></div>
      <div>
        <div style="font-weight:900">GameHub Games</div>
        <div class="kv">Jogos leves ‚Äî integrado</div>
      </div>
    </header>

    <nav class="tabs" id="gameTabs" style="margin-bottom:10px">
      <button class="tab active" data-game="t3">Velha</button>
      <button class="tab" data-game="snake">Cobrinha</button>
      <button class="tab" data-game="flappy">Flappy</button>
      <button class="tab" data-game="memory">Mem√≥ria</button>
      <button class="tab" data-game="puzzle">Quebra-cabe√ßa</button>
    </nav>

    <section class="card">
      <div id="gamesRootArea" class="game-area">
        <!-- T3 -->
        <div id="g-t3" class="g" style="display:block">
          <div style="display:flex;gap:18px;flex-wrap:wrap">
            <div style="flex:1">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div style="font-weight:800">Jogo da Velha</div>
                <div id="t3-status" class="kv">Sua vez: X</div>
              </div>
              <div id="t3-board" class="board" style="margin-top:12px"></div>
              <div class="controls" style="margin-top:12px">
                <button id="t3-start" class="btn">Iniciar</button>
                <button id="t3-diff" class="btn ghost">IA: F√°cil</button>
              </div>
            </div>
            <div style="width:220px">
              <div style="font-weight:900;margin-bottom:8px">Dicas</div>
              <div class="kv">Toque numa casa para jogar. O bot√£o Iniciar reinicia/inicia. Troque a dificuldade com IA: F√°cil/M√©dio/Dif√≠cil.</div>
            </div>
          </div>
        </div>

        <!-- Snake -->
        <div id="g-snake" class="g" style="display:none">
          <div style="display:flex;gap:18px;flex-wrap:wrap">
            <div style="flex:1">
              <canvas id="snake-canvas" class="canvas" width="900" height="540"></canvas>
              <div class="controls" style="margin-top:10px">
                <button id="snake-start" class="btn">Iniciar</button>
                <button id="snake-speed" class="btn ghost">Vel: Normal</button>
              </div>
              <div style="display:flex;gap:8px;margin-top:10px;justify-content:center">
                <button data-dir="up" class="btn ghost" style="width:64px">‚Üë</button>
              </div>
              <div style="display:flex;gap:8px;margin-top:6px;justify-content:center">
                <button data-dir="left" class="btn ghost" style="width:64px">‚Üê</button>
                <button data-dir="down" class="btn ghost" style="width:64px">‚Üì</button>
                <button data-dir="right" class="btn ghost" style="width:64px">‚Üí</button>
              </div>
            </div>
            <div style="width:220px">
              <div style="font-weight:900;margin-bottom:8px">Dicas</div>
              <div class="kv">Use os bot√µes ou swipe no canvas. A cobra acelera com o comprimento.</div>
            </div>
          </div>
        </div>

        <!-- Flappy -->
        <div id="g-flappy" class="g" style="display:none">
          <div style="display:flex;gap:18px;flex-wrap:wrap">
            <div style="flex:1">
              <canvas id="flappy-canvas" class="canvas" width="900" height="540"></canvas>
              <div class="controls" style="margin-top:10px">
                <button id="flappy-start" class="btn">Iniciar</button>
              </div>
            </div>
            <div style="width:220px">
              <div style="font-weight:900;margin-bottom:8px">Dicas</div>
              <div class="kv">Toque no canvas para subir. O jogo reinicia com o bot√£o Iniciar.</div>
            </div>
          </div>
        </div>

        <!-- Memory -->
        <div id="g-memory" class="g" style="display:none">
          <div style="display:flex;gap:18px;flex-wrap:wrap">
            <div style="flex:1">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div style="font-weight:800">Jogo da Mem√≥ria</div>
                <div id="mem-stats" class="kv">0 pares</div>
              </div>
              <div id="mem-grid" class="mem-grid board" style="margin-top:12px"></div>
              <div class="controls" style="margin-top:12px">
                <button id="mem-start" class="btn">Iniciar</button>
              </div>
            </div>
            <div style="width:220px">
              <div style="font-weight:900;margin-bottom:8px">Dicas</div>
              <div class="kv">Toque para virar: resposta imediata, anima√ß√£o suave. Iniciar reinicia.</div>
            </div>
          </div>
        </div>

        <!-- Puzzle -->
        <div id="g-puzzle" class="g" style="display:none">
          <div style="display:flex;gap:18px;flex-wrap:wrap">
            <div style="flex:1">
              <div style="display:flex;justify-content:space-between;align-items:center">
                <div style="font-weight:800">Quebra-cabe√ßa (4x4)</div>
                <div id="puz-stats" class="kv">Embaralhado</div>
              </div>
              <div id="puz-board" class="puz-grid board" style="margin-top:12px"></div>
              <div class="controls" style="margin-top:12px">
                <button id="puz-shuffle" class="btn">Embaralhar</button>
              </div>
            </div>
            <div style="width:220px">
              <div style="font-weight:900;margin-bottom:8px">Dicas</div>
              <div class="kv">Toque na pe√ßa adjacente ao espa√ßo vazio para mover. Embaralhar reinicia.</div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <div class="footer" id="gamesBack">Voltar</div>
  </div>
</div>

<div id="toast" class="toast" aria-hidden="true"></div>

<script>
/* --- Carrega apps.js sem cache --- */
(async function(){
  try{
    const res = await fetch('apps.js?t=' + Date.now(), { cache: 'no-store' });
    if(!res.ok) throw new Error('apps.js n√£o encontrado');
    const js = await res.text();
    const blob = new Blob([js], { type: 'text/javascript' });
    const url = URL.createObjectURL(blob);
    const s = document.createElement('script'); s.src = url;
    s.onload = ()=>{ URL.revokeObjectURL(url); boot(); };
    document.body.appendChild(s);
  }catch(e){
    console.error('Erro ao carregar apps.js, fallback', e);
    const s = document.createElement('script'); s.src='apps.js'; s.onload=boot; document.body.appendChild(s);
  }
})();

function q(id){ return document.getElementById(id); }
function qAll(sel){ return Array.from(document.querySelectorAll(sel)); }
function toast(msg, t=1200){ const el=q('toast'); el.textContent=msg; el.classList.add('show'); setTimeout(()=> el.classList.remove('show'), t); }

/* Boot */
function boot(){
  if(!Array.isArray(window.APPS)) window.APPS = [];
  renderList();
  attachUI();
  router();
}

function getApps(){ return Array.isArray(window.APPS) ? window.APPS.slice().sort((a,b)=> (b.timestamp||0)-(a.timestamp||0)) : []; }
function renderList(items){
  const apps = Array.isArray(items)?items:getApps();
  const list = q('cards');
  if(!apps.length){ list.innerHTML = '<div style="color:var(--muted)">Nenhum app.</div>'; return; }
  list.innerHTML = apps.map(a=>`
    <div class="card" data-slug="${(a.slug||'').replace(/"/g,'')}">
      <div class="thumb">${a.icon?'<img src="'+(a.icon)+'">':''}</div>
      <div class="info">
        <div class="title-card">${(a.title||'')}</div>
        <div style="display:flex;gap:8px;margin-top:6px">${(a.badges||[]).map(b=>'<span style="padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;font-weight:800;font-size:12px">'+(b)+'</span>').join('')}</div>
        <div class="desc">${(a.desc||'')}</div>
        <div class="meta">${(a.version||'')} ¬∑ ${(a.size||'')}</div>
      </div>
      <div class="chev">‚Ä∫</div>
    </div>
  `).join('');
  list.querySelectorAll('.card').forEach(el=>{
    el.addEventListener('click', ()=> openDetail(el.dataset.slug));
  });
}

/* Detail */
function openDetail(slug){
  const app = getApps().find(a=>a.slug===slug); if(!app) return;
  const inner = q('detailInner');
  const screens = (app.screenshots||[]).map(s=>`<img src="${(s)}">`).join('');
  inner.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <button id="backBtn" class="btn ghost">‚Üê Voltar</button>
      <div style="display:flex;gap:8px">
        <a id="downloadBtn" class="btn" href="${(app.download||'#')}" target="_blank" rel="noopener">Baixar</a>
        <button id="copyLinkBtn" class="btn ghost">Copiar link</button>
      </div>
    </div>
    <div class="detail-hero" style="margin-top:12px">${app.screenshots && app.screenshots[0] ? '<img src="'+(app.screenshots[0])+'" style="width:100%;height:100%;object-fit:cover"/>' : (app.icon?'<img src="'+(app.icon)+'" alt="icon" style="width:100%;height:100%;object-fit:cover">':'')}</div>
    <div class="detail-title">${(app.title||'')}</div>
    <div class="kv">${(app.version||'')} ¬∑ ${(app.size||'')}</div>
    <div class="detail-body">${(app.fullDesc || app.desc || '')}</div>
    <div style="margin-top:12px"><strong>Screenshots</strong><div class="screens" style="margin-top:8px">${screens}</div></div>
  `;
  q('detailPage').style.display='block';
  q('backBtn').addEventListener('click', ()=> { q('detailPage').style.display='none'; history.pushState({},'', location.pathname); });
  q('copyLinkBtn').addEventListener('click', async ()=>{
    const url = location.origin + location.pathname + '#/app/' + encodeURIComponent(app.slug);
    try{ await navigator.clipboard.writeText(url); toast('Link copiado'); }catch(e){ toast('Erro ao copiar'); }
  });
  history.pushState({slug}, '', '#/app/' + encodeURIComponent(app.slug));
}

/* UI */
function attachUI(){
  q('openSidebar').addEventListener('click', ()=> { q('sidebar').classList.add('open'); q('sidebar').setAttribute('aria-hidden','false'); q('sideSearch').focus(); });
  q('closeSidebar').addEventListener('click', ()=> { q('sidebar').classList.remove('open'); q('sidebar').setAttribute('aria-hidden','true'); });
  q('sideSearch').addEventListener('input', debounce(()=> searchAndRender(q('sideSearch').value), 160));
  q('gamesLink').addEventListener('click', (e)=> { e.preventDefault(); location.hash = '#/games'; q('sidebar').classList.remove('open'); });
  q('gamesBack').addEventListener('click', ()=> history.back());
  // shareSite fallback: already present as button in sidebar markup
}

function searchAndRender(qv){
  qv = String(qv||'').trim().toLowerCase();
  const apps = getApps();
  const filtered = apps.filter(a=> !qv || ((a.title||'')+' '+(a.desc||'')+' '+(a.fullDesc||'')+' '+(a.tag||'')).toLowerCase().includes(qv));
  renderList(filtered);
}
function debounce(fn,t=180){ let to; return (...a)=>{ clearTimeout(to); to=setTimeout(()=>fn(...a),t); }; }

/* router */
function router(){
  const h = location.hash || '#/';
  if(h.startsWith('#/app/')){ const slug = decodeURIComponent(h.replace('#/app/','')); openDetail(slug); q('homeView').style.display='block'; q('gamesPage').style.display='none'; return; }
  if(h === '#/games' || h.startsWith('#/games/')){ q('homeView').style.display='none'; q('gamesPage').style.display='block'; const parts = h.split('/'); if(parts[2]) openGameTab(parts[2]); else openGameTab('t3'); return; }
  q('homeView').style.display='block'; q('gamesPage').style.display='none';
}
window.addEventListener('hashchange', router);

/* open game tab */
function openGameTab(slug){
  const map = { 'velha':'t3','t3':'t3','snake':'snake','flappy':'flappy','memory':'memory','puzzle':'puzzle' };
  const key = map[slug] || slug || 't3';
  qAll('#gameTabs .tab').forEach(t=> t.classList.toggle('active', t.dataset.game===key));
  qAll('.g').forEach(g=> g.style.display = g.id === 'g-'+key ? 'block' : 'none');
  stopAllGames();
  if(key === 't3') startT3();
  if(key === 'snake') startSnake();
  if(key === 'flappy') startFlappy();
  if(key === 'memory') startMemory();
  if(key === 'puzzle') startPuzzle();
  history.replaceState({},'', '#/games/'+key);
}
qAll('#gameTabs .tab').forEach(t => t.addEventListener('click', ()=> openGameTab(t.dataset.game)));

/* stop all */
function stopAllGames(){
  if(window.stopT3) window.stopT3();
  if(window.stopSnake) window.stopSnake();
  if(window.stopFlappy) window.stopFlappy();
  if(window.stopMemory) window.stopMemory();
  if(window.stopPuzzle) window.stopPuzzle();
}

/* ===================== GAMES IMPLEMENTATIONS ===================== */

/* TICTACTOE with 3 difficulties */
(function(){
  const boardEl = q('t3-board'), status=q('t3-status'), startBtn=q('t3-start'), diffBtn=q('t3-diff');
  let board=[], turn='X', running=false, aiLevel='easy';
  function render(){
    boardEl.innerHTML='';
    for(let i=0;i<9;i++){
      const b=document.createElement('button');
      b.dataset.i=i; b.innerHTML = board[i]||'';
      if(running && !board[i]) b.addEventListener('click', onClick);
      b.addEventListener('pointerdown', ()=> b.style.transform='scale(.98)');
      b.addEventListener('pointerup', ()=> b.style.transform='');
      b.className = '';
      boardEl.appendChild(b);
    }
  }
  function check(bd){
    const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(const w of wins){ const [a,c,d]=w; if(bd[a] && bd[a]===bd[c] && bd[a]===bd[d]) return {win:true,who:bd[a],combo:w}; }
    if(bd.every(x=>x)) return {draw:true}; return {win:false};
  }
  function highlight(combo){ boardEl.querySelectorAll('button').forEach((btn,i)=> { if(combo.includes(i)) btn.classList.add('win'); }); }
  function onClick(e){
    const idx=+e.currentTarget.dataset.i; if(!running || board[idx]) return;
    board[idx]=turn; animateCell(e.currentTarget); afterMove();
  }
  function animateCell(el){ el.animate([{transform:'scale(0.95)'},{transform:'scale(1)'}],{duration:160,fill:'forwards'}); }
  function afterMove(){
    const st=check(board);
    if(st.win){ running=false; status.textContent=`Venceu: ${st.who}`; highlight(st.combo); return; }
    if(st.draw){ running=false; status.textContent='Empate'; return; }
    turn = (turn==='X')?'O':'X'; status.textContent=`Sua vez: ${turn}`;
    if(turn==='O' && running) setTimeout(()=> aiMove(), 240);
    render();
  }
  function aiMove(){
    if(aiLevel==='easy'){ const empties = board.map((v,i)=>v?null:i).filter(x=>x!==null); board[empties[Math.floor(Math.random()*empties.length)]]='O'; }
    else if(aiLevel==='medium'){
      const block = findImmediateWinOrBlock('O') ?? findImmediateWinOrBlock('X');
      if(block!==null) board[block]='O'; else {
        const empties = board.map((v,i)=>v?null:i).filter(x=>x!==null);
        board[empties[Math.floor(Math.random()*empties.length)]]='O';
      }
    } else {
      const mv = minimax(board, 'O').idx;
      board[mv] = 'O';
    }
    afterMove();
  }
  function findImmediateWinOrBlock(player){
    for(let i=0;i<9;i++){
      if(!board[i]){ const copy=board.slice(); copy[i]=player; const st=check(copy); if(st.win && st.who===player) return i; }
    }
    return null;
  }
  function minimax(bd, player){
    const st = check(bd);
    if(st.win){ return {score: st.who==='O'? 10 : -10}; }
    if(st.draw) return {score:0};
    const moves=[];
    for(let i=0;i<9;i++){
      if(!bd[i]){
        const move={idx:i};
        const copy=bd.slice(); copy[i]=player;
        const res = minimax(copy, player==='O'?'X':'O');
        move.score = res.score;
        moves.push(move);
      }
    }
    if(player==='O'){ let best=-Infinity, bestMove=0; moves.forEach(m=>{ if(m.score>best){best=m.score;bestMove=m.idx;} }); return {idx:bestMove,score:best}; }
    else { let best=Infinity, bestMove=0; moves.forEach(m=>{ if(m.score<best){best=m.score;bestMove=m.idx;} }); return {idx:bestMove,score:best}; }
  }
  function start(){ board=Array(9).fill(''); turn='X'; running=true; status.textContent=`Sua vez: ${turn}`; render(); }
  startBtn.addEventListener('click', ()=> { start(); toast('Jogo reiniciado'); });
  diffBtn.addEventListener('click', ()=> {
    aiLevel = aiLevel==='easy'?'medium': aiLevel==='medium'?'hard':'easy';
    diffBtn.textContent = 'IA: ' + (aiLevel==='easy'?'F√°cil': aiLevel==='medium'?'M√©dio':'Dif√≠cil');
    toast('IA: ' + diffBtn.textContent.split(': ')[1]);
  });
  window.startT3 = start; window.stopT3 = ()=> {/* none */};
})();

/* SNAKE ‚Äî canvas, bigger, controls */
(function(){
  const c=q('snake-canvas'), ctx=c.getContext('2d');
  let cols, rows, tile, snake=[], dir={x:1,y:0}, food=null, loop=null, running=false, baseSpeed=160, speedFactor=0;
  function resize(){ const maxW = Math.min(900, window.innerWidth-40); c.width = maxW; c.height = Math.round(maxW * 0.56); cols=Math.floor(c.width/18); rows=Math.floor(c.height/18); tile=Math.floor(Math.min(c.width/cols, c.height/rows)); }
  function draw(){ ctx.fillStyle='#040406'; ctx.fillRect(0,0,c.width,c.height);
    if(food){ ctx.fillStyle='#7c3aed'; ctx.fillRect(food.x*tile+2, food.y*tile+2, tile-4, tile-4); }
    ctx.fillStyle='rgba(124,58,237,0.95)'; snake.forEach(s=> ctx.fillRect(s.x*tile+1, s.y*tile+1, tile-2, tile-2));
  }
  function placeFood(){ let ok=false; while(!ok){ const x=Math.floor(Math.random()*cols), y=Math.floor(Math.random()*rows); ok=!snake.some(s=>s.x===x && s.y===y); if(ok) food={x,y}; } }
  function step(){
    const head={x:snake[0].x+dir.x, y:snake[0].y+dir.y};
    if(head.x<0||head.x>=cols||head.y<0||head.y>=rows || snake.some(s=>s.x===head.x && s.y===head.y)) return gameOver();
    snake.unshift(head);
    if(food && head.x===food.x && head.y===food.y){ placeFood(); speedFactor = Math.min(0.7, snake.length*0.02); }
    else snake.pop();
    draw();
  }
  function gameOver(){ stop(); toast('Game Over'); }
  function start(){
    stop(); resize();
    snake=[{x:Math.floor(cols/2),y:Math.floor(rows/2)}];
    dir={x:1,y:0}; placeFood(); speedFactor=0; running=true;
    loop = setInterval(step, Math.max(60, baseSpeed - Math.round(baseSpeed*speedFactor)));
  }
  function stop(){ running=false; if(loop){ clearInterval(loop); loop=null; } }
  qAll('[data-dir]').forEach(b=> b.addEventListener('click', ()=> { const d=b.dataset.dir; if(d==='up'&&dir.y!==1) dir={x:0,y:-1}; if(d==='down'&&dir.y!==-1) dir={x:0,y:1}; if(d==='left'&&dir.x!==1) dir={x:-1,y:0}; if(d==='right'&&dir.x!==-1) dir={x:1,y:0}; }));
  (function bindSwipe(){
    let sx,sy,ex,ey;
    c.addEventListener('pointerdown', e=> { sx=e.clientX; sy=e.clientY; });
    c.addEventListener('pointerup', e=> { ex=e.clientX; ey=e.clientY; const dx=ex-sx, dy=ey-sy; if(Math.abs(dx)>Math.abs(dy)){ if(dx>20 && dir.x!==-1) dir={x:1,y:0}; if(dx<-20 && dir.x!==1) dir={x:-1,y:0}; } else { if(dy>20 && dir.y!==-1) dir={x:0,y:1}; if(dy<-20 && dir.y!==1) dir={x:0,y:-1}; } });
  })();
  q('snake-start').addEventListener('click', ()=> start());
  q('snake-speed').addEventListener('click', ()=> { baseSpeed = baseSpeed===160?110:160; q('snake-speed').textContent = baseSpeed===160? 'Vel: Normal':'Vel: R√°pida'; toast('Velocidade: ' + (baseSpeed===160?'Normal':'R√°pida')); if(loop){ stop(); start(); } });
  window.startSnake = start; window.stopSnake = stop;
})();

/* FLAPPY */
(function(){
  const c=q('flappy-canvas'), ctx=c.getContext('2d'), startBtn=q('flappy-start');
  let W,H,bird,pipes=[],loop=null,gravity=0.45,gap=110,frame=0;
  function resize(){ const maxW=Math.min(900, window.innerWidth-40); c.width=maxW; c.height=Math.round(maxW*0.56); W=c.width; H=c.height; }
  function reset(){ bird={x:60,y:H/2,vy:0,r:12}; pipes=[]; frame=0; }
  function spawn(){ const top=60+Math.random()*(H-200); pipes.push({x:W,top,passed:false}); if(pipes.length>6) pipes.shift(); }
  function draw(){ ctx.fillStyle='#040406'; ctx.fillRect(0,0,W,H); ctx.fillStyle='#ffdd57'; ctx.beginPath(); ctx.arc(bird.x,bird.y,bird.r,0,Math.PI*2); ctx.fill(); ctx.fillStyle='rgba(124,58,237,0.95)'; pipes.forEach(p=>{ ctx.fillRect(p.x,0,48,p.top); ctx.fillRect(p.x,p.top+gap,48,H-(p.top+gap)); }); }
  function step(){ frame++; bird.vy+=gravity; bird.y+=bird.vy; if(frame%110===0) spawn(); pipes.forEach(p=> p.x-=2.6); if(bird.y+bird.r>H || bird.y-bird.r<0) return gameOver(); for(const p of pipes){ if(bird.x+bird.r>p.x && bird.x-bird.r<p.x+48){ if(bird.y-bird.r<p.top || bird.y+bird.r>p.top+gap) return gameOver(); } } draw(); }
  function gameOver(){ stop(); toast('Game Over'); }
  function start(){ stop(); resize(); reset(); loop=setInterval(step,20); }
  function stop(){ if(loop){ clearInterval(loop); loop=null; } }
  c.addEventListener('pointerdown', ()=> { bird.vy = -8; });
  startBtn.addEventListener('click', ()=> start());
  window.startFlappy = start; window.stopFlappy = stop;
})();

/* MEMORY ‚Äî flip on first click (fixed) */
(function(){
  const grid=q('mem-grid'), stats=q('mem-stats'), startBtn=q('mem-start');
  let icons = ['‚ö°','üéµ','üíé','üéÆ','üß©','üçé','üöÄ','üî•'];
  let cards=[], first=null, lock=false, matches=0;
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }
  function start(){
    const arr = shuffle([...icons,...icons]);
    cards = arr;
    grid.innerHTML = '';
    arr.forEach((ch,i)=>{
      const el = document.createElement('div');
      el.className='mem-card';
      el.dataset.i=i;
      el.innerHTML = `<div class="front">${ch}</div><div class="back"></div>`;
      el.addEventListener('click', onClick);
      grid.appendChild(el);
    });
    first=null; lock=false; matches=0; stats.textContent = `${matches} pares`;
  }
  function onClick(e){
    if(lock) return;
    const el = e.currentTarget;
    const idx = +el.dataset.i;
    if(el.classList.contains('revealed')) return;
    el.classList.add('revealed');
    if(!first){ first = {el,idx}; } else { lock=true; setTimeout(()=> checkPair(first, {el,idx}), 560); }
  }
  function checkPair(a,b){
    if(cards[a.idx] === cards[b.idx]){ matches++; stats.textContent = `${matches} pares`; if(matches === cards.length/2) toast('Voc√™ venceu'); }
    else { a.el.classList.remove('revealed'); b.el.classList.remove('revealed'); }
    first=null; lock=false;
  }
  startBtn.addEventListener('click', ()=> { start(); toast('Mem√≥ria reiniciada'); });
  window.startMemory = start; window.stopMemory = ()=> {};
  start();
})();

/* PUZZLE ‚Äî rounded & smooth */
(function(){
  const board=q('puz-board'), shuffleBtn=q('puz-shuffle'), stats=q('puz-stats');
  let size=4, cells=[], emptyIdx;
  function shuffleArr(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }
  function isSolvable(arr){
    const inv = arr.reduce((acc,v,i)=> acc + (v? arr.slice(i+1).filter(x=>x && x < v).length : 0), 0);
    if(size%2===1) return inv%2===0;
    const row = Math.floor(arr.indexOf(0) / size) + 1;
    return (inv + row) % 2 === 1;
  }
  function start(){
    let arr;
    do { arr = shuffleArr([...Array(size*size).keys()]); } while(!isSolvable(arr));
    cells = arr; emptyIdx = cells.indexOf(0);
    render(); stats.textContent='Embaralhado';
  }
  function render(){
    board.innerHTML = cells.map((v,i)=> `<div class="puz-cell" data-i="${i}" style="height:calc((100vw - 120px)/${size});">${v?v:''}</div>`).join('');
    board.querySelectorAll('.puz-cell').forEach(el=> el.addEventListener('click', onClick));
  }
  function onClick(e){
    const idx=+e.currentTarget.dataset.i;
    const neighbors = adjacent(idx);
    if(neighbors.includes(emptyIdx)){
      [cells[idx], cells[emptyIdx]] = [cells[emptyIdx], cells[idx]];
      emptyIdx = idx;
      render();
      if(cells.slice(0,-1).every((v,i)=> v===i+1)) { stats.textContent='Resolvido'; toast('Puzzle resolvido'); }
    }
  }
  function adjacent(i){
    const row=Math.floor(i/size), col=i%size, res=[];
    if(row>0) res.push((row-1)*size + col);
    if(row<size-1) res.push((row+1)*size + col);
    if(col>0) res.push(row*size + col-1);
    if(col<size-1) res.push(row*size + col+1);
    return res;
  }
  shuffleBtn.addEventListener('click', ()=> { start(); toast('Embaralhado'); });
  window.startPuzzle = start; window.stopPuzzle = ()=> {};
  start();
})();

/* stop games when leaving games view */
window.addEventListener('hashchange', ()=> { if(location.hash.indexOf('#/games')===-1) stopAllGames(); });

window.addEventListener('load', ()=> { router(); });

</script>
</body>
                                                         </html>
